<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="https://www.thymeleaf.org">

<head>
	<meta charset="ISO-8859-1">
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>FORGOT PASSWORD</title>
	<link rel="stylesheet" th:href="@{/css/style.css}">
	<script>
		var onloadCallback = function() {
            var recaptchaElement = document.getElementById('g-recaptcha');
            if (recaptchaElement) {
                grecaptcha.render(recaptchaElement, {
                    'sitekey': '[[${captchaSite}]]',
                    'callback': recaptchaCallback
                });
            }
        };
		
		function recaptchaCallback(response) {
            handleInputFields();
        }
	</script>
	<script src='https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit'></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
</head>
<body>
    <div class="login-page">
			<div th:align="center">
				<img style="padding-bottom: 30px !important"  th:src="@{/images/logo.svg}" alt="Harman" title="Harman" class="logo"/>
			</div>
	
			<div>
                <div class="password-header">Reset Password</div>
				
                <div class="error" style="text-align: center; padding-bottom: 20px; color: red; font-weight: 600; font-size: 14px;" th:if="${error != null}">
                  <p class="text-danger">[[${error}]]</p>
                  
                </div>
				<form action="/recovery/reset" method="post">
				
					<div class="container-auth-input">
						<label for="password" class="hidden" style="font-size: 14px; font-weight: bold; font-family: sans-serif;">New Password</label>
						<input type="password" id="password" name="password" placeholder="New Password"/>
						<div class="error-message" style="display: none; color: red; margin-top: -4px; font-size: 12px; font-weight: bold;">This is required</div>
					</div>
					
					<div class="container-auth-input">
						<label for="confirmPassword" class="hidden" style="font-size: 14px; font-weight: bold; font-family: sans-serif;">Confirm Password</label>
						<input type="password" id="confirmPassword" name="confirmPassword"  placeholder="Confirm Password"/>
						<div class="error-message" style="display: none; color: red; margin-top: -4px; font-size: 12px; font-weight: bold;">This is required</div>

					</div>

					<input type="hidden" name="secret" th:value="${secret}" />
						
					<div id="g-recaptcha" class="g-recaptcha col-sm-5" th:if="(true == ${isCaptchaFieldEnabled})"
						 th:attr="data-sitekey=${captchaSite}">
					</div>
					<span id="captchaError" class="alert alert-danger col-sm-4"
						  style="display:none"></span>	
						
                    <div class="sign-in-custom">
						<button id="submit" type="submit" value="Submit" >
							Submit
						</button>
					</div>					
				</form>
			</div>
			
			<script th:inline="javascript">
				$(document).ready(function() {

					function handleInputFields() {
						var password = $('#password').val().trim();
						var confirmPassword = $('#confirmPassword').val().trim();
						var recaptchaResponse = $('#g-recaptcha-response').val();
						var isCaptchaFieldEnabled = $('#g-recaptcha').length > 0; 
									
						var areFieldsFilled = password !== '' && confirmPassword !== '';

						if (isCaptchaFieldEnabled) {
							areFieldsFilled = areFieldsFilled && recaptchaResponse !== '';
							}

						if (areFieldsFilled) {
							$('#submit').prop('disabled', false).addClass('enabled');
						} else {
							$('#submit').prop('disabled', true).removeClass('enabled');
						}
						

						$('.container-auth-input input').each(function () {
							var inputField = $(this);
							var errorMessage = inputField.siblings('.error-message');
							var label = inputField.siblings('label');

							if (inputField.val().trim() === '' && (inputField.is(':focus') || inputField.attr('data-dirty') === 'true')) {
								errorMessage.show();
							} else {
								errorMessage.hide();
							}

							if (inputField.val().trim() !== '') {
								label.removeClass('hidden');
							} else {
								label.addClass('hidden');
							}
						});
					}


					$('input[type="password"]').on('keyup', function() {
						handleInputFields();
					});

					$('input[type="password"]').on('blur', function() {
						$(this).attr('data-dirty', 'true');
						var errorMessage = $(this).siblings('.error-message');
						if ($(this).val().trim() === '') {
							errorMessage.show();
						} else {
							errorMessage.hide();
						}
						handleInputFields();
					});
					
					handleInputFields();
					

					window.handleInputFields = handleInputFields;
				});
			</script>

			<script th:inline="javascript" th:if="(true == ${isCaptchaFieldEnabled})">
				window.addEventListener('load', () => {
					const $recaptcha = document.querySelector('#g-recaptcha-response');
					if ($recaptcha) {
						$recaptcha.setAttribute('required', 'required');
					}
				})
			</script>
	</div>
	<div class="rights" th:fragment="footer">
		Â© <script>document.write(new Date().getFullYear());</script> HARMAN International. All Rights Reserved.
	</div>
</body>

</html>